Nerophis ophidion Pop Gen notes
1. gunzip file.gz
2. .~/Programs/FastQC/fastqc and check each one
3. ran process_radtags on each plate using the 96barcodes.txt file as the barcode list
4. In jEdit, created 'rename.sh' files with standardized formats and checked the uniqueness of each name
5. Renamed output of process_radtags using the rename files and checked read depth with wc -l *.fq
6. Moved all sample files to ./samples/ folder
7. Ran run_denovo_map.sh
8. Now first pruning with populations
populations -b 3 -P ./stacks/ -M ./nop_map.txt -r 0.75 -a 0.05 -p 6 -t 8 --vcf --plink --structure
9. Then use plink
./plink --file ./stacks/batch_3.plink --r2 --ld-window-r2 0.2 --hardy --noweb --allow-no-sex --write-snplist #to create snplist
plink --file plink --extract neutral.list --allow-no-sex --recode --out neutral --noweb
plink --file ld.subset --freq --within plink.clust.txt --noweb --out ld.subset
plink --file ld.subset --hardy --noweb --allow-no-sex --write-snplist
plink --file ld.subset --extract neutral.snplist --recode-structure --noweb --allow-no-sex
plink --file ld.subset --extract neutral.snplist --recodeA --noweb --allow-no-sex

#######################################LAB BOOK#############################################
#####Tuesday, 7 June 2016
What do I need to continue?
	Get the coordinates of the collecting locations to do IBD analysis
	Use coordinates to download salinity data
	Look at Fsts among populations (pairwise and global).

Emailed Josefin and Olivia for coordinates of the collecting sites. Also emailed Nilla for info about the Finland samples.

Meanwhile, running calculate_global_fst on pruned.ped and pruned.map (these are unlinked but not pruned for HWE).

Fsts are surprisingly clumped around 0.05...it's a normal distribution rather than skewed. Weird. Probalby an artifact due to sequencing error or something.

Plotted the Stacks distributions and they don't seem to be quite as weird.
#####Wednesday, 11 May 2016
	SEW	LEM	GEL	STR	GTL	FIN
SEW		0.0241251	0.0233355	0.0231902	0.036876	0.037098
LEM			0.0279487	0.0270594	0.0374785	0.0363935
GEL				0.0133522	0.0194884	0.0209477
STR					0.0234515	0.0249285
GTL						0.0142245
FIN						

Running coverage_From_stacks
Num individuals	288
Num loci	618457
Average per-locus coverage	3.81336
average per-individual coverage	4.71528
Num Loci with >=5x coverage 	105597
Num loci with >=10x coverage 	5436
Overall minimum per-locus coverage 	0
Overall maximum per-locus coverage 	46198

#####Monday, 9 May 2016
The structure run showed that deltaK was maximized at K=4. Looking at the graphs, though, I'm not sure that's the best interpretation (they all look kind of the same).
Adegenet does not provide clear clusters

I want to re-run populations with the whitelist to get a Fst matrix...
Moved old populations output to 'populations' folder. 

Opened up plink.snplist and replaced _ with \t to have locus\tbp setup. Saved as nop.subset.whitelist.txt

populations -b 3 -P ./stacks -M ./nop_map.txt -s -W ./stacks/nop.subset.whitelist.txt -t 3 --fstats --plink --vcf

#####Sunday, 8 May 2016
I re-ran stacks with different filters and got only 41 polymorphic sites...
I'll just go with the populations run with a 0.05, p 2 and r 0.5. 

Ran the plink files through prune_snps (saved as pruned.ped and pruned.map)
plink --file pruned --hwe 0.001 --noweb --allow-no-sex --write-snplist
1295 markers excluded (genotyping rate is 0.284024)
plink --file pruned --extract plink.snplist --recode --recodeA --recode-structure --out subset --noweb --allow-no-sex
Using 3317 SNPs.

Started structure, admix 10000 and 10000 k=1 through k=6.

The adegenet plot showing missing data shows that the SEW population is missing the most and LEM is missing a lot too.

#####Saturday, 19 March 2016
Starting to parse the structure output
Using Structure harvester, I found that K=4 is best in admixture model but K=2 is best in no admixture model. So clearly I need to do more analyses.
 
Used this and Notepad++ to get a list of the files and then run parse_structure_output
	sarah@sarah-VirtualBox: ls nerophis/structure/nop_popgen/admixture/Results/*_f > ./scripts/parse_nerophis_structure.sh
	sarah@sarah-VirtualBox:~/sf_ubuntushare/popgen$ ls nerophis/structure/nop_popgen/no_admix/Results/*_f >> ./scripts/parse_nerophis_structure.sh

Now I need to run faststructure, adegenet, and PCAdapt.



#####Thursday, 10 March 2016
Wrote parse_structure_output to convert the Results/*_f files into something more readable by R. 

#####Tuesday, 8 March 2016
ran
plink --file pruned --recode-structure --recode --recodeA --noweb --allow-no-sex --out nop.subset
	**Note: Total genotyping rate in remaining individuals is 0.284024
and then started structure

#####Monday, 7 March 2016
So the numbers below are wrong. The populations run with -r 75 had 273 loci.
Let's try
populations -b 3 -P ./stacks -s -t 3 -M ./nop_map.txt -a 0.05 -p 2 -r 0.5 --plink --structure --vcf
That's better. Now there are 6527.

Used prune_snps and ended up with 4612 SNPs.

#####Friday, 4 March 2016
That one was killed too. I guess asking it to keep all 6 populations is too much? Maybe I'll just go with the one with -r 0.75...one last try!
populations -b 3 -P ./stacks -s -t 3 -M ./nop_map.txt -a 0.05 --fstats --plink --structure -p 2 --vcf --vcf_haplotypes
This just isn't working, even without fstats.
#####Thursday, 3 March 2016
Trying this:
populations -b 3 -P ./stacks -s -t 3 -M ./nop_map.txt -a 0.05 --fstats --plink --structure -p 6 --vcf --vcf_haplotypes
The one below was killed.
#####Wednesday, 2 March 2016
/usr/local/bin/populations -b 3 -P ./stacks -s -t 6 -M ./nop_map.txt -a 0.05 --genomic --plink --structure -p 6 --vcf


#####Tuesday, 1 March 2016
/usr/local/bin/populations -b 3 -P ./stacks -s -t 6 -M ./nop_map.txt -r 0.75 -a 0.05 --genomic --plink --structure
resulted in 144780 loci.

Now running populations -b 3 -P ./stacks -s -t 6 -M ./nop_map.txt -r 0.75 -a 0.05 --genomic --plink --structure -p 6
1235



#####Saturday, 27 February 2016
I've installed Stacks v.1.37 on my home computer and I'm going to re-run stacks from the beginning. Added the renaming and moving of files to run_process_radtags.sh
